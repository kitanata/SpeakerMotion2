- extends 'base.haml'

- block 'title'
  {{ event.name }}

- block 'subnav'
  - if user.get_profile == event.owner
      - if event.published
        %a.btn.btn-warning{href:"/event/{{event.id}}/archive?last={{last}}", data-toggle:"tooltip", data-original-title:"Archive Event"}
          %i.icon-ban-circle
      - else
        %a.btn.btn-warning{href:"/event/{{event.id}}/publish?last={{last}}", data-toggle:"tooltip", data-original-title:"Publish Event"}
          %i.icon-ok

      %a.btn.btn-warning.edit-talk{href:"/event/{{event.id}}/edit", data-toggle:"tooltip", data-original-title:"Edit Event"}
        %i.icon-pencil

      - if not event.talkevent_set.all
        %a.btn.btn-warning.delete-event{data-name:"{{event.name}}", data-id:"{{event.id}}", href:"#delete-event-popup", data-toggle:"tooltip", data-original-title:"Delete Event"}
          %i.icon-trash

  - elif not user.is_anonymous
    - if user_talks and event.accept_submissions
      %a.btn.btn-warning.submit-talk{href:"#submit-talk-popup"}
        %i.icon-share-alt
        Submit Talk
    - if user_attending and not user_endorsed
      %a.btn.btn-warning{href:"/event/{{event.id}}/endorse?last={{last}}"}
        %i.icon-thumbs-up
        Endorse
      %a.btn.btn-warning{href:"/event/{{event.id}}/attend?last={{last}}"}
        %i.icon-ban-circle
        Cancel
    - elif event and not user_attending
      %a.btn.btn-warning{href:"/event/{{event.id}}/attend?last={{last}}"}
        %i.icon-calendar
        Attend

- block 'content'
  - include '_event_header_partial.haml'

  #event-detail
    - if upcoming
      .row
        .section-title
          %h2 Upcoming Talks

      .row.buffer
        - for item in upcoming
          - include '_talk_event_span6_detail_partial.haml'

    - if recent
      .row
        .section-title
          %h2 Recent Talks

      .row.buffer
        - for item in past
          - include '_talk_event_span6_detail_partial.haml'

- block 'scripts'
  - include '_popup_event_delete_partial.haml'
  - include '_popup_event_submit_talk_partial.haml'

  %script{type:"text/javascript"}
    (function() {
      L.Icon.Default.imagePath = '{{STATIC_URL}}img/';

      var map = L.map('map').setView([39.95, -82.95], 6);

      L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
          attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
          }).addTo(map);


      var url = "http://nominatim.openstreetmap.org/search/{{city_querystring}}?format=json";
      $.get(url, function(data) {
          if(data.length != 0) {
              map.setView([data[0].lat, data[0].lon], 12);

              var url = "http://nominatim.openstreetmap.org/search/{{querystring}}?format=json";
              $.get(url, function(data) {
                  if(data.length != 0) {
                      L.marker([data[0].lat, data[0].lon]).addTo(map).bindPopup(
                      '<h4>{{event.location.name}}</h4><br />{{event.location.address}}<br />{{event.location.city}}, {{event.location.state}} {{event.location.zip_code}}').openPopup();
                  }
              });
          }
      });
    }).call(this);
